import{r as n,U as K,c as V,N as X,u as Z,b as m,j as e,a as E}from"./index-98f0d127.js";import{d as ee}from"./index.esm-e83a1523.js";import{c as te}from"./index.esm-d04a934b.js";import{b as se}from"./Header-6ac32451.js";import{c as ie,d as oe}from"./index.esm-3249597b.js";import{O}from"./Blocks-3465ce0c.js";const xe=()=>{const[g,S]=n.useState(!1),[k,_]=n.useState(null),{userData:r,fetchBag:f,bagData:o}=n.useContext(K),[C,ne]=n.useState(V()),{checkUserAlreadyLogin:de,notification:R}=n.useContext(X),[G,L]=n.useState(!0),[M,I]=n.useState(!1),[A,v]=n.useState(!1),[h,F]=n.useState({Delivery_Charge:0,GST:0}),[D,y]=n.useState("Hide"),[p,T]=n.useState(0),[W,H]=n.useState([]),[a,b]=n.useState({Discount:0,Coupon_ID:""}),w=n.useRef(null),N=Z(),[l,U]=n.useState([]),B=()=>{let t=0,i=0,s=0;o==null||o.map((c,x)=>{const d=l==null?void 0:l.find(J=>J._id===c.productID),u=((d==null?void 0:d.Price)-50)*c.SmallCount,j=(d==null?void 0:d.Price)*c.MediumCount,P=((d==null?void 0:d.Price)+50)*c.LargeCount;t+=u+j+P}),s=t*18/100,t>500||t===0?i=0:i=40,F({...h,GST:s,Delivery_Charge:i}),T(t+i)},$=async()=>{L(!0),await m.post("/api/fetchProduct",{Available:!0}).then(t=>{U(t.data.data),f()}).catch(t=>{console.log("Error")}).finally(()=>{L(!1)})};n.useEffect(()=>{B()},[l,o]),n.useEffect(()=>{$(),q()},[]),n.useEffect(()=>{const t=i=>{w.current&&!w.current.contains(i.target)&&S(!1)};return document.addEventListener("click",t,!0),()=>{document.removeEventListener("click",t,!0)}},[g]);const Q=async t=>{await m.post("/api/removeFromBag",{productID:t}).then(i=>{f()})},Y=async t=>{o.length>0&&(I(!0),await m.post("/api/orderNow",{...h,TotalAmountPayed:p,...a}).then(i=>{i.data==="Product Ordered"&&(R(i.data,"Success"),f())}).finally(()=>{I(!1)}))},q=async()=>{await m.get("/api/fetchCoupon").then(t=>{H(t.data.Data)}).catch(t=>{console.log(t)})};n.useEffect(()=>{var t;Object.keys(C).length>0?(t=r==null?void 0:r.Bag)==null||t.filter(i=>i.Category===C.categoryID||i._id===C.categoryID):r==null||r.Bag},[C]);const z=t=>{t.Code===a.Coupon_ID?b({Discount:"",Coupon_ID:""}):b({...a,Discount:t.Discount_Allot,Coupon_ID:t.Code}),B()};return n.useEffect(()=>{T(p-a.Discount)},[a]),e.jsx(e.Fragment,{children:g?e.jsx("div",{id:"BagSliderContainer",children:e.jsxs("div",{id:"BagSlider",ref:w,children:[e.jsxs("div",{id:"bag-back-btn",children:[e.jsx(se,{onClick:()=>{S(!g)}}),e.jsx("h3",{children:"BAG"})]}),!r&&e.jsxs("div",{id:"RegiLogin",children:[e.jsx("p",{children:"100 Reward Points on new registration"}),e.jsx("button",{id:"Login-Register-BTN",onClick:()=>N("/auth/login"),children:"LOGIN/ REGISTER"})]}),r?e.jsx(e.Fragment,{children:G?e.jsx(O,{height:"40",width:"60",color:"black",wrapperStyle:{flex:1,marginTop:"50px"},wrapperClass:"bagScroll loading",visible:!0,ariaLabel:"oval-loading",secondaryColor:"black",strokeWidth:4,strokeWidthSecondary:4}):e.jsx("div",{id:"bagScroll",children:(o==null?void 0:o.length)>0?e.jsxs(e.Fragment,{children:[o==null?void 0:o.map((t,i)=>{const s=l==null?void 0:l.find(P=>P._id===t.productID),c=((s==null?void 0:s.Price)-50)*t.SmallCount,x=(s==null?void 0:s.Price)*t.MediumCount,d=((s==null?void 0:s.Price)+50)*t.LargeCount,u=c+x+d;let j=`/products/${s==null?void 0:s.Category}/${s._id}`;return e.jsxs("div",{id:"productCart",onClick:()=>N(j),children:[e.jsxs("div",{id:"productCartFront",children:[e.jsx("img",{src:s.Product_Photo,alt:"CardImage"}),e.jsxs("div",{id:"productDetail",children:[e.jsxs("div",{id:"productName",children:[e.jsx("h3",{children:s.Product_Name}),e.jsxs("h4",{children:["Quantity: ",t.SmallCount>0&&t.SmallCount+"S "," ",t.MediumCount>0&&t.MediumCount+"M "," ",t.LargeCount>0&&t.LargeCount+"L"," "]})]}),e.jsxs("h4",{children:["₹",u]}),e.jsxs("div",{id:"Icons",children:[e.jsx(te,{onClick:()=>Q(t.productID)}),k===i?e.jsx(ie,{onClick:()=>_(null)}):e.jsx(oe,{onClick:()=>_(i)})]})]})]}),e.jsxs("div",{id:"Amount_Info_Show",style:k===i?{height:"100%"}:{height:"0"},children:[e.jsxs("div",{id:"Amount_INFO",children:[e.jsx("h4",{children:"TOTAL :"}),e.jsxs("div",{children:[t.SmallCount>0&&e.jsxs("p",{children:["Regular  x  ",t.SmallCount," "]}),t.MediumCount>0&&e.jsxs("p",{children:["Medium  x  ",t.MediumCount," "]}),t.LargeCount>0&&e.jsxs("p",{children:["Large  x  ",t.LargeCount," "]})]}),e.jsxs("div",{children:[t.SmallCount>0&&e.jsxs("p",{children:["₹",c]}),t.MediumCount>0&&e.jsxs("p",{children:["₹",x]}),t.LargeCount>0&&e.jsxs("p",{children:["₹",d]})]})]}),e.jsxs("div",{id:"TotalAmt",children:[e.jsx("p",{children:"You Pay :"}),e.jsxs("p",{children:["₹",u]})]})]})]},i)}),e.jsxs("div",{id:"Add-Coupon",children:[e.jsx("button",{onClick:()=>{D==="Hide"?(y("Show"),v("bag-order-detail-hide")):y("Hide")},children:"Add Coupon"}),e.jsxs("div",{id:"Add-Coupon-show",className:D,children:[e.jsx("h5",{children:"Add Coupons: "}),e.jsx("table",{children:e.jsx("tbody",{children:W.map(t=>{let i=!1;return i=r.Coupon_Used.find(s=>s.Name===t.Code),e.jsxs("tr",{id:"coupons",className:i?"used_Coupon":"",children:[e.jsx("td",{children:e.jsx("button",{disabled:i,id:a.Coupon_ID===t.Code?"active":"",onClick:()=>z(t),children:t.Code})}),e.jsx("td",{children:e.jsxs("p",{children:[t.Description,"  "]})})]})})})})]})]})]}):e.jsx("div",{id:"productCart",style:{textAlign:"center"},children:"No Item Found in Bag"})})}):e.jsxs("div",{id:"bagScroll",className:"userNotLogin",children:[e.jsxs("p",{children:["Sorry,the ",e.jsx("strong",{children:"ORDER"})," and ",e.jsx("strong",{children:"WISHLIST"})," is restricted to registered users only."]}),e.jsxs("p",{children:["please",e.jsx(E,{to:"/auth/register",children:" register"})," or ",e.jsx(E,{to:"/auth/login",children:"login"})," to continue."]})]}),e.jsxs("div",{id:"bag-order-detail",className:A,children:[e.jsx("h4",{children:"Order Summary"}),e.jsxs("table",{children:[o==null?void 0:o.map((t,i)=>{const s=l==null?void 0:l.find(j=>j._id===t.productID),c=((s==null?void 0:s.Price)-50)*t.SmallCount,x=(s==null?void 0:s.Price)*t.MediumCount,d=((s==null?void 0:s.Price)+50)*t.LargeCount,u=(c+x+d)*(100-18)/100;return e.jsxs("tr",{children:[e.jsx("td",{children:s.Product_Name}),e.jsxs("td",{children:["₹ ",u]})]})}),e.jsxs("tr",{children:[e.jsx("td",{children:"Delivery Charges: "}),e.jsxs("td",{children:["₹ ",h.Delivery_Charge<0&&"-"," ",h.Delivery_Charge]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"GST: "}),e.jsxs("td",{children:["₹ ",h.GST]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Discount: "}),e.jsxs("td",{children:["₹ ",h.Discount>0&&"-"," ",a.Discount]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Order Total:"}),e.jsxs("td",{children:["₹ ",p]})]})]})]}),e.jsxs("div",{id:"Bag-Total-Price",children:[e.jsxs("h4",{children:["Grand Total",o.length>0&&e.jsx("span",{onClick:()=>{A==="bag-order-detail-show"?v("bag-order-detail-hide"):(v("bag-order-detail-show"),y("Hide"))},children:" (Details)"})]}),e.jsxs("h4",{children:["₹ ",p]}),e.jsx("button",{style:o.length>0?{}:{background:"grey"},onClick:Y,children:M?e.jsx(O,{height:"14",width:"14",color:"white",wrapperStyle:{},wrapperClass:"",visible:!0,ariaLabel:"oval-loading",secondaryColor:"white",strokeWidth:6,strokeWidthSecondary:6}):e.jsx(e.Fragment,{children:"ORDER NOW"})})]})]})}):e.jsxs("div",{id:"bagBTN",children:[e.jsx(ee,{onClick:()=>S(!g)}),(o==null?void 0:o.length)>0&&e.jsx("p",{children:o==null?void 0:o.length})]})})};export{xe as B};
