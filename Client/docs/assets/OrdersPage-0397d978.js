import{r as n,N as w,u as b,j as e,b as f,U as y,d as L,a as E}from"./index-ed1235f5.js";import{H as A}from"./Header-47268997.js";import{F as T}from"./Footer-ba6025ba.js";import{S as W}from"./SearchBar-d2db123a.js";import{$ as k}from"./module-6d8f6cfb.js";import{R as B}from"./index-53ba1f7b.js";import{a as U}from"./index.esm-9f69718b.js";import{B as _}from"./Bags-33ce7a04.js";import"./index.esm-e430d503.js";import"./index.esm-06185452.js";import"./index.esm-7e255ccb.js";import"./index.esm-51f27fd1.js";import"./index.esm-5e76bc58.js";import"./index-877835f7.js";import"./index.esm-9034f3f4.js";import"./index-f2e1e368.js";const $=({product:d,orderData:s,ids:v,userData:C,setUserData:p,fetchOrders:l})=>{const[j,m]=n.useState(null),[t,h]=n.useState(20),[a,g]=n.useState(null),[x,S]=n.useState(!1);n.useState([]);const[r,u]=n.useState({Description:"",rating:""}),{checkUserAlreadyLogin:K,notification:R}=n.useContext(w),P=b(),I=async i=>{S(!0),await f.post("/api/cancelOrder",{_id:i}).then(c=>{c.data==="Product Order Cancelled"&&(R(c.data,"Success"),l())}).catch(c=>{console.log(c)}).finally(()=>{S(!1)})},D=i=>{const c=i.target.name,o=i.target.value;u({...r,[c]:o})},F=async(i,c)=>{i.preventDefault(),console.log(c),r.Description.length>0&&r.rating?await f.post("/api/productReview",{...r,_id:c.productID}).then(o=>{o.data.result?(R(o.data.message,"Success"),l()):R(o.data.message,"Un-Success")}).catch(o=>{console.log(o)}):r.Description.length<=0?R("Write Feedback","Un-Success"):r.rating||R("Provide Rating","Un-Success")},N={line:{background:`linear-gradient(to right, red ${t}%, black ${t}%)`,background:`-webkit-linear-gradient(360deg, red ${t}%, black ${t}%)`}};return n.useEffect(()=>{s.status==="ORDER PLACED"&&h(20),s.status==="ORDER PREPARED"&&h(40),s.status==="READY FOR PICKUP"&&h(60),s.status==="ORDER RECEIVED"&&h(100),s.status==="Order Cancelled"&&h(100)},[s]),e.jsxs("div",{id:"order-details",children:[e.jsxs("div",{id:"order-details-inner",children:[e.jsxs("div",{children:[e.jsxs("span",{id:"order-id",children:["Order ID: ",s._id.slice(0,8)," "]}),e.jsxs("span",{id:"order-status",children:[" ",s.status]})]}),e.jsx("span",{id:"order-date",children:new Date(s.orderedAt).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})})]}),e.jsx("div",{id:"orders-Collection",children:s.Orders.map((i,c)=>{const o=i.Price*i.LargeCount+i.Price*i.MediumCount+i.Price*i.SmallCount;return e.jsxs(n.Fragment,{children:[e.jsxs("div",{id:"orderCards",children:[e.jsx("img",{src:i.Product_Photo,alt:i.Product_Name,onClick:()=>P(`/products/${i.Category}/${i._id}`)}),e.jsxs("div",{children:[e.jsxs("div",{id:"product-name-pay",children:[e.jsx("h3",{children:i.Product_Name}),e.jsxs("p",{children:["You Pay: ₹",o," "]})]}),e.jsxs("p",{children:[i.Description.slice(0,200),"..."]})]}),s.status==="ORDER RECEIVED"&&!(i!=null&&i.Reviews.find(O=>O.user_id===C._id))&&e.jsx("button",{onClick:()=>{i._id===a?g(null):g(i._id)},id:"write-feedback",children:"WRITE YOUR FEEDBACK"})]}),a===i._id&&e.jsxs("form",{className:"write-feedback",onSubmit:O=>F(O,i),children:[e.jsx("textarea",{placeholder:"Write your Feedback",id:"feedback",name:"Description",value:r.Description,onChange:D}),e.jsxs("div",{id:"second-write-feedback",children:[e.jsx("button",{type:"submit",children:"Submit Review"}),e.jsxs("div",{children:[e.jsx("p",{children:"Overall Rating*"}),e.jsx(B,{className:"order-rate-antd",allowClear:!1,tooltips:["Very Bad","Bad","Good","Excellent","Awesome"],onChange:O=>{u({...r,rating:O})}})]})]})]})]},c)})}),s.status!=="Order Cancelled"&&e.jsxs("div",{id:"order-summary",children:[e.jsx("h4",{children:"Order Summary"}),e.jsx("table",{children:e.jsxs("thead",{children:[s.Orders.map((i,c)=>{const o=i.Price*i.LargeCount+i.Price*i.MediumCount+i.Price*i.SmallCount;return e.jsxs("tr",{children:[e.jsxs("td",{children:[i.Product_Name,":"]}),e.jsxs("td",{children:["₹ ",o*(100-18)/100]})]},c)}),e.jsxs("tr",{children:[e.jsx("td",{children:"Delivery Charges: "}),e.jsxs("td",{children:["₹ ",s.Delivery_Charge]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"GST: "}),e.jsxs("td",{children:["₹ ",s.GST]})]}),s.Discount>0&&e.jsxs("tr",{children:[e.jsxs("td",{children:["Discount: ",(s==null?void 0:s.Coupon_Used)&&e.jsxs("span",{children:["(",s==null?void 0:s.Coupon_Used,")"]})," "]}),e.jsxs("td",{children:["₹ ",s.Discount]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Order Total:"}),e.jsxs("td",{children:["₹ ",s.TotalAmountPayed]})]})]})})]}),e.jsx("div",{id:"btns",children:s.status!=="ORDER RECEIVED"?e.jsxs(e.Fragment,{children:[s.status!=="Order Cancelled"&&e.jsx("button",{onClick:()=>I(s._id),children:x?e.jsx(k,{height:"14",width:"14",color:"white",wrapperStyle:{},wrapperClass:"",visible:!0,ariaLabel:"oval-loading",secondaryColor:"white",strokeWidth:6,strokeWidthSecondary:6}):e.jsx(e.Fragment,{children:"CANCEL"})}),e.jsx("button",{onClick:()=>{s.productID===j?m(null):m(s.productID)},children:"TRACK YOUR ORDER"})]}):e.jsx(e.Fragment,{})}),j===s.productID&&e.jsx("div",{className:"track-order",children:e.jsxs("div",{children:[e.jsx("div",{id:"Line",style:N.line}),s.status!=="Order Cancelled"?e.jsxs("div",{id:"track-collection",children:[e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:t>=20?"trackDone":"",children:"1"}),e.jsx("h5",{children:"ORDER PLACED "})]}),e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:t>=40?"trackDone":"",children:"2"}),e.jsx("h5",{children:"ORDER PREPARED"})]}),e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:t>=60?"trackDone":"",children:"3"}),e.jsx("h5",{children:"READY FOR PICKUP"})]}),e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:t>=100?"trackDone":"",children:"4"}),e.jsx("h5",{children:"ORDER RECEIVED"})]}),s.status==="Order Cancelled"&&e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:t>=100?"trackDone":"",children:"5"}),e.jsx("h5",{children:"ORDER CANCELLED"})]})]}):e.jsxs("div",{id:"track-collection",children:[e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:t>=20?"trackDone":""}),e.jsx("h5",{children:"ORDER PLACED "})]}),e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:t>=20?"trackDone":"",children:"5"}),e.jsx("h5",{style:{color:"red"},children:"ORDER CANCELLED"})]})]})]})})]})},M=({product:d,userData:s,setUserData:v})=>{const[C,p]=n.useState(!1);n.useContext(w);const{fetchWishList:l,wishlistData:j,fetchBag:m}=n.useContext(y),t=async a=>{j.find(x=>x.productID===a)&&await f.post("/api/removefromWishlist",{productID:a}).then(x=>{l()})},h=async a=>{p(!0),s.Bag.find(x=>x.productID===a)||await f.post("/api/updateBag",{productID:a,SmallCount:0,MediumCount:1,LargeCount:0}).then(x=>{p(!1),t(a),m()}),setTimeout(()=>p(!1),1e3)};return e.jsxs("div",{id:"WishList-Card",children:[e.jsx("img",{src:d==null?void 0:d.Product_Photo,alt:"ImageProduct"}),e.jsxs("div",{id:"productDesc",children:[e.jsx("h2",{children:d==null?void 0:d.Product_Name}),e.jsxs("p",{children:[d==null?void 0:d.Description.slice(0,180),"..."]})]}),e.jsxs("h1",{children:["₹",d==null?void 0:d.Price]}),e.jsx(U,{id:"IconClose",onClick:()=>t(d.productID)}),e.jsx("button",{onClick:()=>h(d.productID),children:C?e.jsx(k,{height:"14",width:"14",color:"white",wrapperStyle:{},wrapperClass:"",visible:!0,ariaLabel:"oval-loading",secondaryColor:"white",strokeWidth:6,strokeWidthSecondary:6}):e.jsx(e.Fragment,{children:s!=null&&s.Bag.find(a=>a.productID===d.productID)?e.jsx(e.Fragment,{children:" Added "}):e.jsx(e.Fragment,{children:"Add to Bag "})})})]})},Y="/assets/scooter-cca3a519.png",H=()=>{const[d,s]=n.useState(!0),{userData:v,setUserData:C,fetchWishList:p,wishlistData:l}=n.useContext(y),[j,m]=n.useState("Show"),[t,h]=n.useState([]),a=b(),g=L(),x=async()=>{m("Show"),await p(),await S(),m("Hide")},S=async()=>{await f.get("/api/fetchOrders").then(r=>{h(r.data.data)}).catch(r=>{console.log(r)})};return n.useEffect(()=>{x()},[]),n.useEffect(()=>{g.orders==="my-wishlist"?s(!1):s(!0)},[g]),e.jsxs(e.Fragment,{children:[e.jsx(W,{bgColor:"white"}),e.jsxs("div",{id:"Orders",children:[e.jsxs("div",{id:"order-wishlists",children:[e.jsx("h3",{onClick:()=>{a("/orders/my-order")},id:d?"active":"",children:"MY ORDERS"}),e.jsx("h3",{onClick:()=>{a("/orders/my-wishlist")},id:d?"":"active",children:"MY WISHLIST"})]}),j==="Hide"?e.jsx(e.Fragment,{children:v?e.jsx(e.Fragment,{children:d?e.jsx(e.Fragment,{children:(t==null?void 0:t.length)>0?e.jsx("div",{id:"orderCardsContainer",children:t==null?void 0:t.toReversed().map((r,u)=>e.jsx($,{fetchOrders:S,orderData:r,ids:u,userData:v,setUserData:C},r+u))}):e.jsx("div",{id:"orderCardsContainer",children:"No order is Placed till now"})}):e.jsx(e.Fragment,{children:(l==null?void 0:l.length)>0?e.jsx("div",{id:"wishlist",children:e.jsx("div",{id:"orderCardsContainer",children:l==null?void 0:l.toReversed().map((r,u)=>e.jsx(M,{product:r,userData:v,setUserData:C},r+u))})}):e.jsx("div",{id:"orderCardsContainer",children:"No Item Found"})})}):e.jsxs("div",{id:"orderCardsContainer",className:"userNotLogin",children:[e.jsxs("p",{children:["Sorry,the ",e.jsx("strong",{children:"ORDER"})," and ",e.jsx("strong",{children:"WISHLIST"})," is restricted to registered users only."]}),e.jsxs("p",{children:["please",e.jsx(E,{to:"/auth/register",children:" register"})," or ",e.jsx(E,{to:"/auth/login",children:"login"})," to continue."]})]})}):e.jsx(e.Fragment,{children:j==="Show"?e.jsx("div",{id:"orderCardsContainer",children:e.jsx(k,{height:"40",width:"60",color:"black",wrapperStyle:{marginTop:"100px"},wrapperClass:"orderProduct loading",visible:!0,ariaLabel:"oval-loading",secondaryColor:"white",strokeWidth:4,strokeWidthSecondary:4})}):e.jsx("div",{id:"orderCardsContainer",children:e.jsxs("div",{className:"loadingBTN",children:[e.jsx("p",{children:"Something went wrong"}),e.jsx("button",{onClick:fetchProducts,children:"Try again"})]})})})]}),e.jsx("img",{src:Y,alt:"Scooter",id:"scooterIMG"}),e.jsx(_,{})]})},ce=()=>e.jsxs(e.Fragment,{children:[e.jsx(A,{}),e.jsx(H,{}),e.jsx(T,{})]});export{ce as default};
