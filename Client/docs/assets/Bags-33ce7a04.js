import{r as d,u as S,U as _,j as e,b as p,N as V,e as Z,a as P}from"./index-ed1235f5.js";import{g as ee}from"./index.esm-5e76bc58.js";import{b as se,c as te,d as ne}from"./Header-47268997.js";import{$ as E}from"./module-6d8f6cfb.js";import{c as oe,G as re}from"./index.esm-9f69718b.js";import{c as de,d as ie}from"./index.esm-7e255ccb.js";import{S as f}from"./index-877835f7.js";import{F as le}from"./index.esm-9034f3f4.js";import{l as ae}from"./index-f2e1e368.js";const ce=({bag:s,link:n})=>{const[r,a]=d.useState(!1),i=S(),{fetchBag:h}=d.useContext(_),t=async u=>{await p.post("/api/removeFromBag",{productID:u}).then(A=>{h()})};return e.jsx(e.Fragment,{children:e.jsxs("div",{id:"productCart",onClick:()=>i(n),children:[e.jsxs("div",{id:"productCartFront",children:[e.jsx("img",{src:s.Product_Photo,alt:"CardImage"}),e.jsxs("div",{id:"productDetail",children:[e.jsxs("div",{id:"productName",children:[e.jsx("h3",{children:s.Product_Name}),e.jsxs("h4",{children:["Quantity: ",s.SmallCount>0&&s.SmallCount+"S "," ",s.MediumCount>0&&s.MediumCount+"M "," ",s.LargeCount>0&&s.LargeCount+"L"," "]})]}),e.jsxs("h4",{children:["₹",s.Total]}),e.jsxs("div",{id:"Icons",children:[e.jsx(oe,{onClick:()=>t(s.productID)}),r?e.jsx(de,{onClick:()=>a(null)}):e.jsx(ie,{onClick:()=>a(!0)})]})]})]}),e.jsxs("div",{id:"Amount_Info_Show",style:r?{height:"100%"}:{height:"0"},children:[e.jsxs("div",{id:"Amount_INFO",children:[e.jsx("h4",{children:"TOTAL :"}),e.jsxs("div",{children:[s.SmallCount>0&&e.jsxs("p",{children:["Regular x ",s.SmallCount," "]}),s.MediumCount>0&&e.jsxs("p",{children:["Medium x ",s.MediumCount," "]}),s.LargeCount>0&&e.jsxs("p",{children:["Large x ",s.LargeCount," "]})]}),e.jsxs("div",{children:[s.SmallCount>0&&e.jsxs("p",{children:["₹",s.smallPrice]}),s.MediumCount>0&&e.jsxs("p",{children:["₹",s.mediumPrice]}),s.LargeCount>0&&e.jsxs("p",{children:["₹",s.largePrice]})]})]}),e.jsxs("div",{id:"TotalAmt",children:[e.jsx("p",{children:"You Pay :"}),e.jsxs("p",{children:["₹",s.Total]})]})]})]})})};function he(s){return re({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"9 18 15 12 9 6"}}]})(s)}const B="/assets/Home-7038ba0f.png",H="/assets/Hotel-ec9376fc.png",I="/assets/Building-fdc4ac71.png",O="/assets/Other-5cde9ea6.png",ue=({setShowBag:s,bagOption:n,setBagOption:r})=>{const[a,i]=d.useState([{}]),h=async()=>{await p.get("/api/fetchAddress").then(t=>{i(t.data.userSavedAddress)})};return d.useEffect(()=>{h()},[]),e.jsxs("div",{id:"Select_Address",children:[e.jsxs("div",{id:"Add-New-Address-Btn",onClick:()=>s("AddNewAddress"),children:[e.jsx(se,{}),e.jsx("p",{children:"Add new address"}),e.jsx(he,{})]}),e.jsx("h5",{children:"Your saved addresses"}),a.map(t=>e.jsxs("div",{id:"saved-Address",className:t.combineText===n.address?"selected-Address":"",onClick:()=>r({...n,address:t.combineText}),children:[t.AddressAs?e.jsxs(e.Fragment,{children:[t.AddressAs==="Home"&&e.jsx("img",{src:B,alt:"HomeLogo"}),t.AddressAs==="Work"&&e.jsx("img",{src:I,alt:"HomeLogo"}),t.AddressAs==="Hotel"&&e.jsx("img",{src:H,alt:"HomeLogo"}),t.AddressAs==="Other"&&e.jsx("img",{src:O,alt:"HomeLogo"})]}):e.jsx(f,{style:{width:"50px",height:"50px"}}),e.jsxs("div",{children:[e.jsx("h4",{children:t.AddressAs||e.jsx(f,{})}),e.jsx("p",{children:t.combineText||e.jsx(f,{count:2})})]})]}))]})},me=({setShowBag:s})=>{const[n,r]=d.useState({FlatNumber:null,Floor:null,Locality:null,landmark:null,Name:null,Contact_Number:null,AddressAs:"Home",State:null}),a=t=>{const u=t.target.name,A=t.target.value;r({...n,[u]:A})},i=t=>{r({...n,AddressAs:t})},h=async t=>{t.preventDefault(),await p.post("/api/addAddress",n).then(u=>{u.data.result&&s(2)}).catch(u=>{console.log(u)})};return e.jsxs("div",{id:"Add-New-Address",children:[e.jsx("p",{children:"Save address as *"}),e.jsxs("div",{id:"SaveAddressAs",children:[e.jsxs("button",{className:"save-Address-As",id:n.AddressAs==="Home"?"active":null,onClick:()=>i("Home"),children:[e.jsx("img",{src:B,alt:"HomeLogo"}),e.jsx("span",{children:"Home"})]}),e.jsxs("button",{className:"save-Address-As",id:n.AddressAs==="Work"?"active":null,onClick:()=>i("Work"),children:[e.jsx("img",{src:I,alt:"HomeLogo"}),e.jsx("span",{children:"Work"})]}),e.jsxs("button",{className:"save-Address-As",id:n.AddressAs==="Hotel"?"active":null,onClick:()=>i("Hotel"),children:[e.jsx("img",{src:H,alt:"HomeLogo"}),e.jsx("span",{children:"Hotel"})]}),e.jsxs("button",{className:"save-Address-As",id:n.AddressAs==="Other"?"active":null,onClick:()=>i("Other"),children:[e.jsx("img",{src:O,alt:"HomeLogo"}),e.jsx("span",{children:"Other"})]})]}),e.jsxs("form",{onSubmit:h,children:[e.jsx("label",{htmlFor:"FlatNumber",children:"Flat / House no / Building name *"}),e.jsx("input",{type:"text",name:"FlatNumber",id:"FlatNumber",value:n.FlatNumber,onChange:a,placeholder:"Enter Flat / House no / Building name *",required:!0}),e.jsx("label",{htmlFor:"Floor",children:"Floor (optional)"}),e.jsx("input",{type:"text",name:"Floor",id:"Floor",value:n.Floor,onChange:a,placeholder:"Floor (optional)"}),e.jsx("label",{htmlFor:"Locality",children:"Area / Sector / Locality *"}),e.jsx("input",{type:"text",name:"Locality",id:"Locality",value:n.Locality,onChange:a,placeholder:"Enter Area / Sector / Locality *",required:!0}),e.jsx("label",{htmlFor:"landmark",children:"Nearby landmark (optional)"}),e.jsx("input",{type:"text",name:"landmark",id:"landmark",value:n.landmark,onChange:a,placeholder:"Enter Nearby landmark (optional)"}),e.jsx("label",{htmlFor:"State",children:"State"}),e.jsx("input",{type:"text",name:"State",id:"State",value:n.State,onChange:a,placeholder:"Enter State"}),e.jsx("label",{htmlFor:"Name",children:"Enter your details for seamless delivery experience"}),e.jsx("input",{type:"text",name:"Name",id:"Name",value:n.Name,onChange:a,placeholder:"Your name *",required:!0}),e.jsx("label",{htmlFor:"Contact_Number",children:"Your phone number (optional)"}),e.jsx("input",{type:"number",name:"Contact_Number",id:"Contact_Number",value:n.Contact_Number,min:"1111111111",max:"9999999999",onChange:a,placeholder:"Enter Contact Number",required:!0}),e.jsx("input",{type:"submit",value:"Save address"})]})]})},xe=({bagOption:s,setBagOption:n})=>e.jsxs("div",{id:"PaymentOption",children:[e.jsx("h4",{children:"RECOMMENDED"}),e.jsxs("label",{htmlFor:"deliveryOption1",id:"Payment-Options",children:[e.jsx("input",{type:"radio",name:"paymentThrough",id:"deliveryOption1",onChange:r=>n({...s,paymentThrough:r.target.value}),value:"Cash on Delivery/Pay on Delivery"}),e.jsxs("div",{children:[e.jsx("p",{children:"Cash on Delivery/Pay on Delivery"}),e.jsx("span",{children:"Cash, UPI and Cards accepted."})]})]}),e.jsx("h4",{children:"RECOMMENDED"}),e.jsxs("label",{htmlFor:"deliveryOption2",id:"Payment-Options",children:[e.jsx("input",{type:"radio",name:"paymentThrough",id:"deliveryOption2",onChange:r=>n({...s,paymentThrough:r.target.value}),value:"Paid Online"}),e.jsxs("div",{children:[e.jsx("p",{children:"Pay online by UPI, Credit or Debit Cards"}),e.jsx("span",{children:"UPI and Cards accepted online"})]})]})]}),pe=({setShowBag:s})=>{const n=S();return e.jsxs("div",{id:"order-status",children:[e.jsx("div",{id:"outer-tick-animation",children:e.jsx(le,{id:"tickGIF"})}),e.jsx("h3",{children:"Congratulations!!!"}),e.jsx("p",{children:"Your order have been taken and being attended to"}),e.jsx("button",{onClick:()=>{s(0),n("/orders/my-order")},id:"track-order",children:"Track order"}),e.jsx("button",{onClick:()=>{s(0),n("/products")},id:"continue-ordering",children:"Continue ordering food"})]})},je=({bagData:s,Charges:n,Discount_Allot:r,GrandTotal:a})=>e.jsxs("div",{id:"bag-order-detail",children:[e.jsx("h4",{children:"Order Summary"}),e.jsxs("table",{children:[s==null?void 0:s.map((i,h)=>{const t=Math.ceil(i.Total*82/100);return e.jsxs("tr",{children:[e.jsx("td",{children:i.Product_Name}),e.jsxs("td",{children:["₹ ",t]})]},h)}),e.jsxs("tr",{children:[e.jsx("td",{children:"GST: "}),e.jsxs("td",{children:["₹ ",n.GST]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Discount: "}),e.jsxs("td",{children:["₹ ",n.Discount>0&&"-"," ",r.Discount]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Delivery Charges: "}),e.jsxs("td",{children:["₹ ",n.Delivery_Charge<0&&"-"," ",n.Delivery_Charge]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Grand Total:"}),e.jsxs("td",{children:["₹ ",a]})]})]})]}),ge=ae("pk_test_51PIBzKBApeRXee97n2UpjWtEqJfL0P2djHw6aEtmkrEBtRlRKAEWBpTLBTrjtopfQqjK08pNnqMbWuwX48Xy6fEi00FUChBPSg"),Te=()=>{const[s,n]=d.useState(0),[r,a]=d.useState({address:null,paymentThrough:null}),{userData:i,fetchBag:h,bagData:t,setBagData:u}=d.useContext(_),{checkUserAlreadyLogin:A,notification:k}=d.useContext(V),[R,N]=d.useState(!0),[M,w]=d.useState(!1),[Ce,G]=d.useState(!1),[g,W]=d.useState({Delivery_Charge:0,GST:0}),[F,T]=d.useState("Hide"),[j,L]=d.useState(0),[U,$]=d.useState([]),[m,b]=d.useState({Discount:0,Coupon_ID:""}),y=d.useRef(null),C=S(),x=Z(),D=()=>{let o=0,l=0;if(t.length>0){let c=t.reduce((v,J)=>v+J.Total,0);o=Math.ceil(c*18/100),c>500||c===0?l=0:l=40,W({...g,GST:o,Delivery_Charge:l}),L(c+l)}};d.useEffect(()=>{D()},[t]),d.useEffect(()=>{let o=x.pathname.split("/bag")[0];x.pathname.split("/").slice(-1)[0]==="success"&&(n("success"),C(`${o}`)),x.pathname.split("/").slice(-1)[0]==="canceled"&&C(`${o}`)},[]);const q=async()=>{N(!0),await h(),await Q(),N(!1)};d.useEffect(()=>{q()},[]),d.useEffect(()=>{const o=l=>{y.current&&!y.current.contains(l.target)&&n(0)};return document.addEventListener("click",o,!0),()=>{document.removeEventListener("click",o,!0)}},[s]);const Y=async()=>{const o=await ge;await p.post("/api/create-food-order-session",{...g,TotalAmountPayed:j,...m,Address:r.address,paymentThrough:r.paymentThrough,URL:x.pathname.split("/bag")[0],userID:i._id,Full_Name:i.Full_Name,Email:i.Email}).then(async l=>{const c=l.data.id,{error:v}=await o.redirectToCheckout({sessionId:c});v&&console.error("Stripe Checkout error:",v)})},X=async o=>{t.length>0&&(r.paymentThrough!=="Paid Online"?(w(!0),await p.post("/api/orderNow",{...g,TotalAmountPayed:j,...m,Address:r.address,paymentThrough:r.paymentThrough}).then(l=>{console.log(l.data),l.data==="Product Ordered"&&(u([]),n("success"))}).catch(l=>{console.log(l)}).finally(()=>{w(!1)})):Y())},K=()=>{(t==null?void 0:t.length)>0&&(s===2&&!r.address?k("Please Select Address First","Warning"):s===3&&!r.paymentThrough?k("Please Select Payment Option","Warning"):s<3&&n(s+1),s===3&&r.paymentThrough&&(console.log("Running"),X()))},Q=async()=>{await p.get("/api/fetchCoupon").then(o=>{$(o.data.Data)}).catch(o=>{console.log(o)})},z=o=>{o.Code===m.Coupon_ID?b({Discount:"",Coupon_ID:""}):b({...m,Discount:o.Discount_Allot,Coupon_ID:o.Code}),D()};return d.useEffect(()=>{L(j-m.Discount)},[m]),e.jsx(e.Fragment,{children:s!==0?e.jsx("div",{id:"BagSliderContainer",children:e.jsxs("div",{id:"BagSlider",ref:y,children:[e.jsxs("div",{id:"bag-back-btn",children:[e.jsx(te,{onClick:()=>{let o=s-1;s==="success"?(x.pathname.includes("/bag")&&C(x.pathname.split("/bag")[0]),n(0),console.log(x.pathname)):n(s==="AddNewAddress"?2:o)}}),e.jsxs("h3",{children:[s===1&&"BAG",s===2&&"Select address",s==="AddNewAddress"&&"Enter complete adderess",s===3&&"Select a payment method"]})]}),!i&&e.jsxs("div",{id:"RegiLogin",children:[e.jsx("p",{children:"100 Reward Points on new registration"}),e.jsx("button",{id:"Login-Register-BTN",onClick:()=>C("/auth/login"),children:"LOGIN/ REGISTER"})]}),i?e.jsx(e.Fragment,{children:R?e.jsx(E,{height:"40",width:"60",color:"black",wrapperStyle:{flex:1,marginTop:"50px"},wrapperClass:"bagScroll loading",visible:!0,ariaLabel:"oval-loading",secondaryColor:"black",strokeWidth:4,strokeWidthSecondary:4}):e.jsxs("div",{id:"bagScroll",children:[s===1&&e.jsx(e.Fragment,{children:(t==null?void 0:t.length)>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"orderProductDetails",children:[t==null?void 0:t.map((o,l)=>{let c=`/products/${o==null?void 0:o.Category}/${o._id}`;return e.jsx(d.Fragment,{children:e.jsx(ce,{bag:o,link:c})},l)}),e.jsxs("div",{id:"Add-Coupon",children:[e.jsx("button",{onClick:()=>{F==="Hide"?(T("Show"),G("bag-order-detail-hide")):T("Hide")},children:"Add Coupon"}),e.jsxs("div",{id:"Add-Coupon-show",className:F,children:[e.jsx("h5",{children:"Add Coupons: "}),e.jsx("table",{children:e.jsx("tbody",{children:U.map(o=>{let l=!1;return l=i.Coupon_Used.find(c=>c.Name===o.Code),e.jsxs("tr",{id:"coupons",className:l?"used_Coupon":"",children:[e.jsx("td",{children:e.jsx("button",{disabled:l,id:m.Coupon_ID===o.Code?"active":"",onClick:()=>z(o),children:o.Code})}),e.jsx("td",{children:e.jsxs("p",{children:[o.Description," "]})})]})})})})]})]})]}),e.jsx(je,{bagData:t,Discount_Allot:m,Charges:g,GrandTotal:j})]}):e.jsx("div",{id:"productCart",style:{textAlign:"center",marginTop:"20px"},children:"No Item Found in Bag"})}),s===2&&e.jsx(ue,{setShowBag:n,bagOption:r,setBagOption:a}),s==="AddNewAddress"&&e.jsx(me,{setShowBag:n}),s===3&&e.jsx(xe,{bagOption:r,setBagOption:a}),s==="success"&&e.jsx(pe,{setShowBag:n})]})}):e.jsxs("div",{id:"bagScroll",className:"userNotLogin",children:[e.jsxs("p",{children:["Sorry,the ",e.jsx("strong",{children:"ORDER"})," and ",e.jsx("strong",{children:"WISHLIST"})," is restricted to registered users only."]}),e.jsxs("p",{children:["please",e.jsx(P,{to:"/auth/register",children:" register"})," or ",e.jsx(P,{to:"/auth/login",children:"login"})," to continue."]})]}),s!=="AddNewAddress"&&i&&s!=="success"&&t.length!==0&&e.jsxs("div",{id:"Bag-Total-Price",children:[e.jsx("h4",{children:"Grand Total"}),e.jsxs("h4",{children:["₹ ",j]}),e.jsx("button",{style:t.length>0?{}:{background:"grey"},onClick:K,children:M?e.jsx(E,{wrapperStyle:{flex:1},wrapperClass:"bagScroll loading",visible:!0,ariaLabel:"oval-loading",height:"30",color:"white",secondaryColor:"white",strokeWidth:4,strokeWidthSecondary:4}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"NEXT"}),e.jsx(ne,{})]})})]})]})}):e.jsxs("div",{id:"bagBTN",children:[e.jsx(ee,{onClick:()=>n(s+1)}),(t==null?void 0:t.length)>0&&e.jsx("p",{children:t==null?void 0:t.length})]})})};export{Te as B};
