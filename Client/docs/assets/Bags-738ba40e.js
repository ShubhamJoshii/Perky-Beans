import{r as o,U as $,c as H,N as Q,u as Y,j as e,a as T,b as v}from"./index-5c2fc0ab.js";import{d as q}from"./index.esm-7d62f1ed.js";import{c as z}from"./index.esm-96b25de3.js";import{b as J}from"./Header-f26ec214.js";import{b as K,c as V}from"./index.esm-d3d9663e.js";import{O as I}from"./Blocks-c51b83d5.js";const re=()=>{const[u,m]=o.useState(!1),[y,P]=o.useState(null),{userData:c,fetchBag:C,bagData:i}=o.useContext($),[g,X]=o.useState(H()),{checkUserAlreadyLogin:Z,notification:B}=o.useContext(Q),[N,w]=o.useState(!0),[b,L]=o.useState(!1),[_,A]=o.useState(!1),[j,O]=o.useState({Delivery_Charge:0,GST:0,Discount:0}),[p,R]=o.useState(0),S=o.useRef(null),k=Y(),[l,E]=o.useState([]),G=()=>{let t=0,n=0,s=0,a=0;i==null||i.map((d,h)=>{const r=l==null?void 0:l.find(U=>U._id===d.productID),x=((r==null?void 0:r.Price)-50)*d.SmallCount,f=(r==null?void 0:r.Price)*d.MediumCount,W=((r==null?void 0:r.Price)+50)*d.LargeCount;t+=x+f+W}),s=t*18/100,t>500||t===0?n=0:n=40,O({GST:s,Delivery_Charge:n,Discount:a}),R(t+n-a)},M=async()=>{w(!0),await v.post("/api/fetchProduct",{Available:!0}).then(t=>{E(t.data.data),C()}).catch(t=>{console.log("Error")}).finally(()=>{w(!1)})};o.useEffect(()=>{G()},[l,i]),o.useEffect(()=>{M()},[]),o.useEffect(()=>{const t=n=>{S.current&&!S.current.contains(n.target)&&m(!1)};return document.addEventListener("click",t,!0),()=>{document.removeEventListener("click",t,!0)}},[u]);const F=async t=>{await v.post("/api/removeFromBag",{productID:t}).then(n=>{C()})},D=async t=>{i.length>0&&(L(!0),await v.post("/api/orderNow",{...j,TotalAmountPayed:p}).then(n=>{n.data==="Product Ordered"&&(B(n.data,"Success"),C())}).finally(()=>{L(!1)}))};return o.useEffect(()=>{var t;Object.keys(g).length>0?(t=c==null?void 0:c.Bag)==null||t.filter(n=>n.Category===g.categoryID||n._id===g.categoryID):c==null||c.Bag},[g]),e.jsx(e.Fragment,{children:u?e.jsx("div",{id:"BagSliderContainer",children:e.jsxs("div",{id:"BagSlider",ref:S,children:[e.jsxs("div",{id:"bag-back-btn",children:[e.jsx(J,{onClick:()=>{m(!u)}}),e.jsx("h3",{children:"BAG"})]}),!c&&e.jsxs("div",{id:"RegiLogin",children:[e.jsx("p",{children:"100 Reward Points on new registration"}),e.jsx("button",{id:"Login-Register-BTN",onClick:()=>k("/auth/login"),children:"LOGIN/ REGISTER"})]}),c?e.jsx(e.Fragment,{children:N?e.jsx(I,{height:"40",width:"60",color:"black",wrapperStyle:{flex:1,marginTop:"50px"},wrapperClass:"bagScroll loading",visible:!0,ariaLabel:"oval-loading",secondaryColor:"black",strokeWidth:4,strokeWidthSecondary:4}):e.jsx("div",{id:"bagScroll",children:(i==null?void 0:i.length)>0?e.jsx(e.Fragment,{children:i==null?void 0:i.map((t,n)=>{const s=l==null?void 0:l.find(f=>f._id===t.productID),a=((s==null?void 0:s.Price)-50)*t.SmallCount,d=(s==null?void 0:s.Price)*t.MediumCount,h=((s==null?void 0:s.Price)+50)*t.LargeCount,r=a+d+h;let x=`/products/${s==null?void 0:s.Category}/${s._id}`;return e.jsxs("div",{id:"productCart",onClick:()=>k(x),children:[e.jsxs("div",{id:"productCartFront",children:[e.jsx("img",{src:s.Product_Photo,alt:"CardImage"}),e.jsxs("div",{id:"productDetail",children:[e.jsxs("div",{id:"productName",children:[e.jsx("h3",{children:s.Product_Name}),e.jsxs("h4",{children:["Quantity: ",t.SmallCount>0&&t.SmallCount+"S "," ",t.MediumCount>0&&t.MediumCount+"M "," ",t.LargeCount>0&&t.LargeCount+"L"," "]})]}),e.jsxs("h4",{children:["₹",r]}),e.jsxs("div",{id:"Icons",children:[e.jsx(z,{onClick:()=>F(t.productID)}),y===n?e.jsx(K,{onClick:()=>P(null)}):e.jsx(V,{onClick:()=>P(n)})]})]})]}),e.jsxs("div",{id:"Amount_Info_Show",style:y===n?{height:"100%"}:{height:"0"},children:[e.jsxs("div",{id:"Amount_INFO",children:[e.jsx("h4",{children:"TOTAL :"}),e.jsxs("div",{children:[t.SmallCount>0&&e.jsxs("p",{children:["Regular  x  ",t.SmallCount," "]}),t.MediumCount>0&&e.jsxs("p",{children:["Medium  x  ",t.MediumCount," "]}),t.LargeCount>0&&e.jsxs("p",{children:["Large  x  ",t.LargeCount," "]})]}),e.jsxs("div",{children:[t.SmallCount>0&&e.jsxs("p",{children:["₹",a]}),t.MediumCount>0&&e.jsxs("p",{children:["₹",d]}),t.LargeCount>0&&e.jsxs("p",{children:["₹",h]})]})]}),e.jsxs("div",{id:"TotalAmt",children:[e.jsx("p",{children:"You Pay :"}),e.jsxs("p",{children:["₹",r]})]})]})]},n)})}):e.jsx("div",{id:"productCart",style:{textAlign:"center"},children:"No Item Found in Bag"})})}):e.jsxs("div",{id:"bagScroll",className:"userNotLogin",children:[e.jsxs("p",{children:["Sorry,the ",e.jsx("strong",{children:"ORDER"})," and ",e.jsx("strong",{children:"WISHLIST"})," is restricted to registered users only."]}),e.jsxs("p",{children:["please",e.jsx(T,{to:"/auth/register",children:" register"})," or ",e.jsx(T,{to:"/auth/login",children:"login"})," to continue."]})]}),e.jsxs("div",{id:"bag-order-detail",className:_,children:[e.jsx("h4",{children:"Order Summary"}),e.jsxs("table",{children:[i==null?void 0:i.map((t,n)=>{const s=l==null?void 0:l.find(x=>x._id===t.productID),a=((s==null?void 0:s.Price)-50)*t.SmallCount,d=(s==null?void 0:s.Price)*t.MediumCount,h=((s==null?void 0:s.Price)+50)*t.LargeCount,r=(a+d+h)*(100-18)/100;return e.jsxs("tr",{children:[e.jsx("td",{children:s.Product_Name}),e.jsxs("td",{children:["₹ ",r]})]})}),e.jsxs("tr",{children:[e.jsx("td",{children:"Delivery Charges: "}),e.jsxs("td",{children:["₹ ",j.Delivery_Charge]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"GST: "}),e.jsxs("td",{children:["₹ ",j.GST]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Discount: "}),e.jsxs("td",{children:["₹ ",j.Discount]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Order Total:"}),e.jsxs("td",{children:["₹ ",p]})]})]})]}),e.jsxs("div",{id:"Bag-Total-Price",children:[e.jsxs("h4",{children:["Grand Total",e.jsx("span",{onClick:()=>A(t=>t==="bag-order-detail-show"?"bag-order-detail-hide":"bag-order-detail-show"),children:" (Details)"})]}),e.jsxs("h4",{children:["₹ ",p]}),e.jsx("button",{style:i.length>0?{}:{background:"grey"},onClick:D,children:b?e.jsx(I,{height:"14",width:"14",color:"white",wrapperStyle:{},wrapperClass:"",visible:!0,ariaLabel:"oval-loading",secondaryColor:"white",strokeWidth:6,strokeWidthSecondary:6}):e.jsx(e.Fragment,{children:"ORDER NOW"})})]})]})}):e.jsxs("div",{id:"bagBTN",children:[e.jsx(q,{onClick:()=>m(!u)}),(i==null?void 0:i.length)>0&&e.jsx("p",{children:i==null?void 0:i.length})]})})};export{re as B};
