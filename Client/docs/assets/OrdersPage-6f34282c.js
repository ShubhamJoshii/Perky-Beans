import{r as d,N,u as F,j as e,b as S,U as L,d as A,a as D}from"./index-8e9028a4.js";import{H as B}from"./Header-53593a74.js";import{F as T}from"./Footer-c72fc1dd.js";import{S as W}from"./SearchBar-ae9d53da.js";import{O as I}from"./Blocks-8ea0c07c.js";import{R as _}from"./index-7cc0a326.js";import{a as U}from"./index.esm-4d07417e.js";import{B as M}from"./Bags-09152859.js";import"./index.esm-4ef58ca6.js";import"./index.esm-850366f0.js";import"./index.esm-5cd34d49.js";import"./index.esm-dd604ada.js";import"./index.esm-fb83e93d.js";const Y=({product:r,orderData:s,ids:j,userData:f,setUserData:w,fetchProducts:g})=>{const[O,R]=d.useState(null),[a,n]=d.useState(20),[u,l]=d.useState(null),[C,h]=d.useState(!1);d.useState([]);const[c,E]=d.useState({Description:"",rating:""}),{checkUserAlreadyLogin:b,notification:p}=d.useContext(N),k=F(),y=async t=>{h(!0),await S.post("/api/cancelOrder",{_id:t}).then(i=>{i.data==="Product Order Cancelled"&&(p(i.data,"Success"),g())}).catch(i=>{console.log(i)}).finally(()=>{h(!1)})},o=t=>{const i=t.target.name,x=t.target.value;E({...c,[i]:x})},v=async(t,i)=>{t.preventDefault(),console.log(i),c.Description.length>0&&c.rating?await S.post("/api/productReview",{...c,_id:i.productID}).then(x=>{x.data.result?(p(x.data.message,"Success"),g()):p(x.data.message,"Un-Success")}).catch(x=>{console.log(x)}):c.Description.length<=0?p("Write Feedback","Un-Success"):c.rating||p("Provide Rating","Un-Success")},P={line:{background:`linear-gradient(to right, red ${a}%, black ${100-a}%)`,background:`-webkit-linear-gradient(360deg, red ${a}%, black ${100-a}%)`}};return d.useEffect(()=>{s.status==="ORDER PLACED"&&n(20),s.status==="ORDER PREPARED"&&n(40),s.status==="READY FOR PICKUP"&&n(60),s.status==="ORDER RECEIVED"&&n(100),s.status==="Order Cancelled"&&n(100)},[s]),e.jsxs("div",{id:"order-details",children:[e.jsxs("div",{id:"order-details-inner",children:[e.jsxs("div",{children:[e.jsxs("span",{id:"order-id",children:["Order ID: ",s._id.slice(0,8)," "]}),e.jsxs("span",{id:"order-status",children:[" ",s.status]})]}),e.jsx("span",{id:"order-date",children:new Date(s.orderedAt).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})})]}),e.jsx("div",{id:"orders-Collection",children:s.Orders.map(t=>{const i=r.find(m=>m._id===t.productID),x=i.Price*t.LargeCount+i.Price*t.MediumCount+i.Price*t.SmallCount;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"orderCards",children:[e.jsx("img",{src:i.Product_Photo,alt:i.Product_Name,onClick:()=>k(`/products/${i.Category}/${i._id}`)}),e.jsxs("div",{children:[e.jsxs("div",{id:"product-name-pay",children:[e.jsx("h3",{children:i.Product_Name}),e.jsxs("p",{children:["You Pay: ₹",x," "]})]}),e.jsxs("p",{children:[i.Description.slice(0,200),"..."]})]}),s.status==="ORDER RECEIVED"&&!(i!=null&&i.Reviews.find(m=>m.user_id===f._id))&&e.jsx("button",{onClick:()=>{t._id===u?l(null):l(t._id)},id:"write-feedback",children:"WRITE YOUR FEEDBACK"})]}),u===t._id&&e.jsxs("form",{className:"write-feedback",onSubmit:m=>v(m,t),children:[e.jsx("textarea",{placeholder:"Write your Feedback",id:"feedback",name:"Description",value:c.Description,onChange:o}),e.jsxs("div",{id:"second-write-feedback",children:[e.jsx("button",{type:"submit",children:"Submit Review"}),e.jsxs("div",{children:[e.jsx("p",{children:"Overall Rating*"}),e.jsx(_,{className:"order-rate-antd",allowClear:!1,tooltips:["Very Bad","Bad","Good","Excellent","Awesome"],onChange:m=>{E({...c,rating:m})}})]})]})]})]})})}),s.status!=="Order Cancelled"&&e.jsxs("div",{id:"order-summary",children:[e.jsx("h4",{children:"Order Summary"}),e.jsxs("table",{children:[s.Orders.map(t=>{const i=r.find(m=>m._id===t.productID),x=i.Price*t.LargeCount+i.Price*t.MediumCount+i.Price*t.SmallCount;return e.jsxs("tr",{children:[e.jsxs("td",{children:[i.Product_Name,":"]}),e.jsxs("td",{children:["₹ ",x*(100-18)/100]})]})}),e.jsxs("tr",{children:[e.jsx("td",{children:"Delivery Charges: "}),e.jsxs("td",{children:["₹ ",s.Delivery_Charge]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"GST: "}),e.jsxs("td",{children:["₹ ",s.GST]})]}),s.Discount>0&&e.jsxs("tr",{children:[e.jsxs("td",{children:["Discount: ",(s==null?void 0:s.Coupon_Used)&&e.jsxs("span",{children:["(",s==null?void 0:s.Coupon_Used,")"]})," "]}),e.jsxs("td",{children:["₹ ",s.Discount]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Order Total:"}),e.jsxs("td",{children:["₹ ",s.TotalAmountPayed]})]})]})]}),e.jsx("div",{id:"btns",children:s.status!=="ORDER RECEIVED"?e.jsxs(e.Fragment,{children:[s.status!=="Order Cancelled"&&e.jsx("button",{onClick:()=>y(s._id),children:C?e.jsx(I,{height:"14",width:"14",color:"white",wrapperStyle:{},wrapperClass:"",visible:!0,ariaLabel:"oval-loading",secondaryColor:"white",strokeWidth:6,strokeWidthSecondary:6}):e.jsx(e.Fragment,{children:"CANCEL"})}),e.jsx("button",{onClick:()=>{s.productID===O?R(null):R(s.productID)},children:"TRACK YOUR ORDER"})]}):e.jsx(e.Fragment,{})}),O===s.productID&&e.jsx("div",{className:"track-order",children:e.jsxs("div",{children:[e.jsx("div",{id:"Line",style:P.line}),s.status!=="Order Cancelled"?e.jsxs("div",{id:"track-collection",children:[e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:a>=20?"trackDone":"",children:"1"}),e.jsx("h5",{children:"ORDER PLACED "})]}),e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:a>=40?"trackDone":"",children:"2"}),e.jsx("h5",{children:"ORDER PREPARED"})]}),e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:a>=60?"trackDone":"",children:"3"}),e.jsx("h5",{children:"READY FOR PICKUP"})]}),e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:a>=100?"trackDone":"",children:"4"}),e.jsx("h5",{children:"ORDER RECEIVED"})]}),s.status==="Order Cancelled"&&e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:a>=100?"trackDone":"",children:"5"}),e.jsx("h5",{children:"ORDER CANCELLED"})]})]}):e.jsxs("div",{id:"track-collection",children:[e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:a>=20?"trackDone":""}),e.jsx("h5",{children:"ORDER PLACED "})]}),e.jsxs("div",{id:"timeStamp-Order",children:[e.jsx("div",{id:"currStage-Order",className:a>=20?"trackDone":"",children:"5"}),e.jsx("h5",{style:{color:"red"},children:"ORDER CANCELLED"})]})]})]})})]})},H=({product:r,orderData:s,userData:j,setUserData:f})=>{const[w,g]=d.useState(!1);d.useContext(N);const{fetchWishList:O,wishlistData:R,fetchBag:a}=d.useContext(L),n=async l=>{let C=R.find(h=>h.productID===l);console.log("Clicked",C),C&&await S.post("/api/removefromWishlist",{productID:l}).then(h=>{O()})},u=async l=>{g(!0),j.Bag.find(h=>h.productID===l)||await S.post("/api/addtoBag",{productID:l,SmallCount:0,MediumCount:1,LargeCount:0}).then(h=>{g(!1),n(l),a()}),setTimeout(()=>g(!1),1e3)};return e.jsxs("div",{id:"WishList-Card",children:[e.jsx("img",{src:r==null?void 0:r.Product_Photo,alt:"ImageProduct"}),e.jsxs("div",{id:"productDesc",children:[e.jsx("h2",{children:r==null?void 0:r.Product_Name}),e.jsxs("p",{children:[r==null?void 0:r.Description.slice(0,180),"..."]})]}),e.jsxs("h1",{children:["₹",r==null?void 0:r.Price]}),e.jsx(U,{id:"IconClose",onClick:()=>n(s.productID)}),e.jsx("button",{onClick:()=>u(s.productID),children:w?e.jsx(I,{height:"14",width:"14",color:"white",wrapperStyle:{},wrapperClass:"",visible:!0,ariaLabel:"oval-loading",secondaryColor:"white",strokeWidth:6,strokeWidthSecondary:6}):e.jsx(e.Fragment,{children:j!=null&&j.Bag.find(l=>l.productID===s.productID)?e.jsx(e.Fragment,{children:" Added "}):e.jsx(e.Fragment,{children:"Add to Bag "})})})]})},$="/assets/scooter-cca3a519.png",K=()=>{const[r,s]=d.useState(!0),{userData:j,setUserData:f,fetchBag:w,fetchWishList:g,addToBag:O,addToWishlist:R,bagData:a,wishlistData:n}=d.useContext(L),[u,l]=d.useState(null),[C,h]=d.useState("Show"),[c,E]=d.useState([]),b=F(),p=A(),k=async()=>{h("Show"),await S.post("/api/fetchProduct",{Available:!1}).then(o=>{l(o.data.data),h("Hide"),g(),y()}).catch(o=>{console.log("Error"),h("LoadBtnShow")})};d.useEffect(()=>{k()},[]),d.useEffect(()=>{p.orders==="my-wishlist"?s(!1):s(!0)},[p]);const y=async()=>{await S.get("/api/fetchOrders").then(o=>{E(o.data.data)})};return e.jsxs(e.Fragment,{children:[e.jsx(W,{bgColor:"white"}),e.jsxs("div",{id:"Orders",children:[e.jsxs("div",{id:"order-wishlists",children:[e.jsx("h3",{onClick:()=>{b("/orders/my-order")},id:r?"active":"",children:"MY ORDERS"}),e.jsx("h3",{onClick:()=>{b("/orders/my-wishlist")},id:r?"":"active",children:"MY WISHLIST"})]}),C==="Hide"?e.jsx(e.Fragment,{children:j?e.jsx(e.Fragment,{children:r?e.jsx(e.Fragment,{children:(c==null?void 0:c.length)>0?e.jsx("div",{id:"orderCardsContainer",children:c==null?void 0:c.toReversed().map((o,v)=>e.jsx(Y,{product:u,fetchProducts:k,orderData:o,ids:v,userData:j,setUserData:f},o+v))}):e.jsx("div",{id:"orderCardsContainer",children:"No order is Placed till now"})}):e.jsx(e.Fragment,{children:(n==null?void 0:n.length)>0?e.jsx("div",{id:"wishlist",children:e.jsx("div",{id:"orderCardsContainer",children:n==null?void 0:n.toReversed().map((o,v)=>{const P=u==null?void 0:u.find(t=>t._id===o.productID);return e.jsx(H,{product:P,orderData:o,userData:j,setUserData:f},o+v)})})}):e.jsx("div",{id:"orderCardsContainer",children:"No Item Found"})})}):e.jsxs("div",{id:"orderCardsContainer",className:"userNotLogin",children:[e.jsxs("p",{children:["Sorry,the ",e.jsx("strong",{children:"ORDER"})," and ",e.jsx("strong",{children:"WISHLIST"})," is restricted to registered users only."]}),e.jsxs("p",{children:["please",e.jsx(D,{to:"/auth/register",children:" register"})," or ",e.jsx(D,{to:"/auth/login",children:"login"})," to continue."]})]})}):e.jsx(e.Fragment,{children:C==="Show"?e.jsx("div",{id:"orderCardsContainer",children:e.jsx(I,{height:"40",width:"60",color:"black",wrapperStyle:{marginTop:"100px"},wrapperClass:"orderProduct loading",visible:!0,ariaLabel:"oval-loading",secondaryColor:"white",strokeWidth:4,strokeWidthSecondary:4})}):e.jsx("div",{id:"orderCardsContainer",children:e.jsxs("div",{className:"loadingBTN",children:[e.jsx("p",{children:"Something went wrong"}),e.jsx("button",{onClick:k,children:"Try again"})]})})})]}),e.jsx("img",{src:$,alt:"Scooter",id:"scooterIMG"}),e.jsx(M,{})]})},de=()=>e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx(K,{}),e.jsx(T,{})]});export{de as default};
