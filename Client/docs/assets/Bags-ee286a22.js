import{r as o,u as y,U as D,j as e,b as p,N as J,a as b}from"./index-04e2cc78.js";import{g as K}from"./index.esm-28aa77ef.js";import{b as V,c as Z,d as ee}from"./Header-71da15e5.js";import{$ as T}from"./module-36a6d8f5.js";import{c as se,G as te}from"./index.esm-825d002b.js";import{c as ne,d as de}from"./index.esm-da0dab77.js";import{S as v}from"./index-c2168812.js";import{F as oe}from"./index.esm-1ecf3452.js";const re=({bag:s,link:n})=>{const[r,l]=o.useState(!1),a=y(),{fetchBag:c}=o.useContext(D),t=async x=>{await p.post("/api/removeFromBag",{productID:x}).then(j=>{c()})};return e.jsx(e.Fragment,{children:e.jsxs("div",{id:"productCart",onClick:()=>a(n),children:[e.jsxs("div",{id:"productCartFront",children:[e.jsx("img",{src:s.Product_Photo,alt:"CardImage"}),e.jsxs("div",{id:"productDetail",children:[e.jsxs("div",{id:"productName",children:[e.jsx("h3",{children:s.Product_Name}),e.jsxs("h4",{children:["Quantity: ",s.SmallCount>0&&s.SmallCount+"S "," ",s.MediumCount>0&&s.MediumCount+"M "," ",s.LargeCount>0&&s.LargeCount+"L"," "]})]}),e.jsxs("h4",{children:["₹",s.Total]}),e.jsxs("div",{id:"Icons",children:[e.jsx(se,{onClick:()=>t(s.productID)}),r?e.jsx(ne,{onClick:()=>l(null)}):e.jsx(de,{onClick:()=>l(!0)})]})]})]}),e.jsxs("div",{id:"Amount_Info_Show",style:r?{height:"100%"}:{height:"0"},children:[e.jsxs("div",{id:"Amount_INFO",children:[e.jsx("h4",{children:"TOTAL :"}),e.jsxs("div",{children:[s.SmallCount>0&&e.jsxs("p",{children:["Regular x ",s.SmallCount," "]}),s.MediumCount>0&&e.jsxs("p",{children:["Medium x ",s.MediumCount," "]}),s.LargeCount>0&&e.jsxs("p",{children:["Large x ",s.LargeCount," "]})]}),e.jsxs("div",{children:[s.SmallCount>0&&e.jsxs("p",{children:["₹",s.smallPrice]}),s.MediumCount>0&&e.jsxs("p",{children:["₹",s.mediumPrice]}),s.LargeCount>0&&e.jsxs("p",{children:["₹",s.largePrice]})]})]}),e.jsxs("div",{id:"TotalAmt",children:[e.jsx("p",{children:"You Pay :"}),e.jsxs("p",{children:["₹",s.Total]})]})]})]})})};function ie(s){return te({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"9 18 15 12 9 6"}}]})(s)}const _="/assets/Home-7038ba0f.png",B="/assets/Hotel-ec9376fc.png",H="/assets/Building-fdc4ac71.png",O="/assets/Other-5cde9ea6.png",le=({setShowBag:s,bagOption:n,setBagOption:r})=>{const[l,a]=o.useState([{}]),c=async()=>{await p.get("/api/fetchAddress").then(t=>{a(t.data.userSavedAddress)})};return o.useEffect(()=>{c()},[]),e.jsxs("div",{id:"Select_Address",children:[e.jsxs("div",{id:"Add-New-Address-Btn",onClick:()=>s("AddNewAddress"),children:[e.jsx(V,{}),e.jsx("p",{children:"Add new address"}),e.jsx(ie,{})]}),e.jsx("h5",{children:"Your saved addresses"}),l.map(t=>e.jsxs("div",{id:"saved-Address",className:t.combineText===n.address?"selected-Address":"",onClick:()=>r({...n,address:t.combineText}),children:[t.AddressAs?e.jsxs(e.Fragment,{children:[t.AddressAs==="Home"&&e.jsx("img",{src:_,alt:"HomeLogo"}),t.AddressAs==="Work"&&e.jsx("img",{src:H,alt:"HomeLogo"}),t.AddressAs==="Hotel"&&e.jsx("img",{src:B,alt:"HomeLogo"}),t.AddressAs==="Other"&&e.jsx("img",{src:O,alt:"HomeLogo"})]}):e.jsx(v,{style:{width:"50px",height:"50px"}}),e.jsxs("div",{children:[e.jsx("h4",{children:t.AddressAs||e.jsx(v,{})}),e.jsx("p",{children:t.combineText||e.jsx(v,{count:2})})]})]}))]})},ae=({setShowBag:s})=>{const[n,r]=o.useState({FlatNumber:"",Floor:"",Locality:"",landmark:"",Name:"",Contact_Number:"",AddressAs:"Home"}),l=t=>{const x=t.target.name,j=t.target.value;r({...n,[x]:j})},a=t=>{r({...n,AddressAs:t})},c=async t=>{t.preventDefault();let j=[n.Floor,n.FlatNumber,n.Locality,n.landmark].join(" ");console.log(j),await p.post("/api/addAddress",n).then(m=>{m.data.result&&s(2)}).catch(m=>{console.log(m)})};return e.jsxs("div",{id:"Add-New-Address",children:[e.jsx("p",{children:"Save address as *"}),e.jsxs("div",{id:"SaveAddressAs",children:[e.jsxs("button",{className:"save-Address-As",id:n.AddressAs==="Home"?"active":"",onClick:()=>a("Home"),children:[e.jsx("img",{src:_,alt:"HomeLogo"}),e.jsx("span",{children:"Home"})]}),e.jsxs("button",{className:"save-Address-As",id:n.AddressAs==="Work"?"active":"",onClick:()=>a("Work"),children:[e.jsx("img",{src:H,alt:"HomeLogo"}),e.jsx("span",{children:"Work"})]}),e.jsxs("button",{className:"save-Address-As",id:n.AddressAs==="Hotel"?"active":"",onClick:()=>a("Hotel"),children:[e.jsx("img",{src:B,alt:"HomeLogo"}),e.jsx("span",{children:"Hotel"})]}),e.jsxs("button",{className:"save-Address-As",id:n.AddressAs==="Other"?"active":"",onClick:()=>a("Other"),children:[e.jsx("img",{src:O,alt:"HomeLogo"}),e.jsx("span",{children:"Other"})]})]}),e.jsxs("form",{onSubmit:c,children:[e.jsx("label",{htmlFor:"FlatNumber",children:"Flat / House no / Building name *"}),e.jsx("input",{type:"text",name:"FlatNumber",id:"FlatNumber",value:n.FlatNumber,onChange:l,placeholder:"Enter Flat / House no / Building name *",required:!0}),e.jsx("label",{htmlFor:"Floor",children:"Floor (optional)"}),e.jsx("input",{type:"text",name:"Floor",id:"Floor",value:n.Floor,onChange:l,placeholder:"Floor (optional)"}),e.jsx("label",{htmlFor:"Locality",children:"Area / Sector / Locality *"}),e.jsx("input",{type:"text",name:"Locality",id:"Locality",value:n.Locality,onChange:l,placeholder:"Enter Area / Sector / Locality *",required:!0}),e.jsx("label",{htmlFor:"landmark",children:"Nearby landmark (optional)"}),e.jsx("input",{type:"text",name:"landmark",id:"landmark",value:n.landmark,onChange:l,placeholder:"Enter Nearby landmark (optional)"}),e.jsx("label",{htmlFor:"Name",children:"Enter your details for seamless delivery experience"}),e.jsx("input",{type:"text",name:"Name",id:"Name",value:n.Name,onChange:l,placeholder:"Your name *",required:!0}),e.jsx("label",{htmlFor:"Contact_Number",children:"Your phone number (optional)"}),e.jsx("input",{type:"number",name:"Contact_Number",id:"Contact_Number",value:n.Contact_Number,min:"1111111111",max:"9999999999",onChange:l,placeholder:"Enter Contact Number",required:!0}),e.jsx("input",{type:"submit",value:"Save address"})]})]})},ce=({bagOption:s,setBagOption:n})=>e.jsxs("div",{id:"PaymentOption",children:[e.jsx("h4",{children:"RECOMMENDED"}),e.jsxs("label",{htmlFor:"deliveryOption1",id:"Payment-Options",children:[e.jsx("input",{type:"radio",name:"cashOnDelivery",id:"deliveryOption1",onChange:r=>n({...s,paymentThrough:r.target.value}),value:"Cash on Delivery/Pay on Delivery"}),e.jsxs("div",{children:[e.jsx("p",{children:"Cash on Delivery/Pay on Delivery"}),e.jsx("span",{children:"Cash, UPI and Cards accepted."})]})]})]}),he=({setShowBag:s})=>{const n=y();return e.jsxs("div",{id:"order-status",children:[e.jsx("div",{id:"outer-tick-animation",children:e.jsx(oe,{id:"tickGIF"})}),e.jsx("h3",{children:"Congratulations!!!"}),e.jsx("p",{children:"Your order have been taken and being attended to"}),e.jsx("button",{onClick:()=>{s(0),n("/orders/my-order")},id:"track-order",children:"Track order"}),e.jsx("button",{onClick:()=>{s(0),n("/products")},id:"continue-ordering",children:"Continue ordering food"})]})},ue=({bagData:s,Charges:n,Discount_Allot:r,GrandTotal:l})=>e.jsxs("div",{id:"bag-order-detail",children:[e.jsx("h4",{children:"Order Summary"}),e.jsxs("table",{children:[s==null?void 0:s.map((a,c)=>{const t=Math.ceil(a.Total*82/100);return e.jsxs("tr",{children:[e.jsx("td",{children:a.Product_Name}),e.jsxs("td",{children:["₹ ",t]})]},c)}),e.jsxs("tr",{children:[e.jsx("td",{children:"GST: "}),e.jsxs("td",{children:["₹ ",n.GST]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Discount: "}),e.jsxs("td",{children:["₹ ",n.Discount>0&&"-"," ",r.Discount]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Delivery Charges: "}),e.jsxs("td",{children:["₹ ",n.Delivery_Charge<0&&"-"," ",n.Delivery_Charge]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Grand Total:"}),e.jsxs("td",{children:["₹ ",l]})]})]})]}),fe=()=>{const[s,n]=o.useState(0),[r,l]=o.useState({address:null,paymentThrough:null}),{userData:a,fetchBag:c,bagData:t,setBagData:x}=o.useContext(D),{checkUserAlreadyLogin:j,notification:m}=o.useContext(J),[P,f]=o.useState(!0),[I,S]=o.useState(!1),[xe,E]=o.useState(!1),[C,R]=o.useState({Delivery_Charge:0,GST:0}),[k,N]=o.useState("Hide"),[g,w]=o.useState(0),[G,M]=o.useState([]),[u,F]=o.useState({Discount:0,Coupon_ID:""}),A=o.useRef(null),W=y(),L=()=>{let d=0,i=0;if(t.length>0){let h=t.reduce((X,z)=>X+z.Total,0);d=Math.ceil(h*18/100),h>500||h===0?i=0:i=40,R({...C,GST:d,Delivery_Charge:i}),w(h+i)}};o.useEffect(()=>{L()},[t]);const U=async()=>{f(!0),await c(),await q(),f(!1)};o.useEffect(()=>{U()},[]),o.useEffect(()=>{const d=i=>{A.current&&!A.current.contains(i.target)&&n(0)};return document.addEventListener("click",d,!0),()=>{document.removeEventListener("click",d,!0)}},[s]);const $=async d=>{t.length>0&&(S(!0),await p.post("/api/orderNow",{...C,TotalAmountPayed:g,...u,Address:r.address,paymentThrough:r.paymentThrough}).then(i=>{console.log(i.data),i.data==="Product Ordered"&&(x([]),n(4))}).catch(i=>{console.log(i)}).finally(()=>{S(!1)}))},Y=()=>{(t==null?void 0:t.length)>0&&(s===2&&!r.address?m("Please Select Address First","Warning"):s===3&&!r.paymentThrough?m("Please Select Payment Option","Warning"):s<3&&n(s+1),s===3&&r.paymentThrough&&(console.log("Running"),$()))},q=async()=>{await p.get("/api/fetchCoupon").then(d=>{M(d.data.Data)}).catch(d=>{console.log(d)})},Q=d=>{d.Code===u.Coupon_ID?F({Discount:"",Coupon_ID:""}):F({...u,Discount:d.Discount_Allot,Coupon_ID:d.Code}),L()};return o.useEffect(()=>{w(g-u.Discount)},[u]),e.jsx(e.Fragment,{children:s!==0?e.jsx("div",{id:"BagSliderContainer",children:e.jsxs("div",{id:"BagSlider",ref:A,children:[e.jsxs("div",{id:"bag-back-btn",children:[e.jsx(Z,{onClick:()=>{let d=s-1;n(s===4?1:s==="AddNewAddress"?2:d)}}),e.jsxs("h3",{children:[s===1&&"BAG",s===2&&"Select address",s==="AddNewAddress"&&"Enter complete adderess",s===3&&"Select a payment method"]})]}),!a&&e.jsxs("div",{id:"RegiLogin",children:[e.jsx("p",{children:"100 Reward Points on new registration"}),e.jsx("button",{id:"Login-Register-BTN",onClick:()=>W("/auth/login"),children:"LOGIN/ REGISTER"})]}),a?e.jsx(e.Fragment,{children:P?e.jsx(T,{height:"40",width:"60",color:"black",wrapperStyle:{flex:1,marginTop:"50px"},wrapperClass:"bagScroll loading",visible:!0,ariaLabel:"oval-loading",secondaryColor:"black",strokeWidth:4,strokeWidthSecondary:4}):e.jsxs("div",{id:"bagScroll",children:[s===1&&e.jsx(e.Fragment,{children:(t==null?void 0:t.length)>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"orderProductDetails",children:[t==null?void 0:t.map((d,i)=>{let h=`/products/${d==null?void 0:d.Category}/${d._id}`;return e.jsx(o.Fragment,{children:e.jsx(re,{bag:d,link:h})},i)}),e.jsxs("div",{id:"Add-Coupon",children:[e.jsx("button",{onClick:()=>{k==="Hide"?(N("Show"),E("bag-order-detail-hide")):N("Hide")},children:"Add Coupon"}),e.jsxs("div",{id:"Add-Coupon-show",className:k,children:[e.jsx("h5",{children:"Add Coupons: "}),e.jsx("table",{children:e.jsx("tbody",{children:G.map(d=>{let i=!1;return i=a.Coupon_Used.find(h=>h.Name===d.Code),e.jsxs("tr",{id:"coupons",className:i?"used_Coupon":"",children:[e.jsx("td",{children:e.jsx("button",{disabled:i,id:u.Coupon_ID===d.Code?"active":"",onClick:()=>Q(d),children:d.Code})}),e.jsx("td",{children:e.jsxs("p",{children:[d.Description," "]})})]})})})})]})]})]}),e.jsx(ue,{bagData:t,Discount_Allot:u,Charges:C,GrandTotal:g})]}):e.jsx("div",{id:"productCart",style:{textAlign:"center",marginTop:"20px"},children:"No Item Found in Bag"})}),s===2&&e.jsx(le,{setShowBag:n,bagOption:r,setBagOption:l}),s==="AddNewAddress"&&e.jsx(ae,{setShowBag:n}),s===3&&e.jsx(ce,{bagOption:r,setBagOption:l}),s===4&&e.jsx(he,{setShowBag:n})]})}):e.jsxs("div",{id:"bagScroll",className:"userNotLogin",children:[e.jsxs("p",{children:["Sorry,the ",e.jsx("strong",{children:"ORDER"})," and ",e.jsx("strong",{children:"WISHLIST"})," is restricted to registered users only."]}),e.jsxs("p",{children:["please",e.jsx(b,{to:"/auth/register",children:" register"})," or ",e.jsx(b,{to:"/auth/login",children:"login"})," to continue."]})]}),s!=="AddNewAddress"&&a&&s!==4&&t.length!==0&&e.jsxs("div",{id:"Bag-Total-Price",children:[e.jsx("h4",{children:"Grand Total"}),e.jsxs("h4",{children:["₹ ",g]}),e.jsx("button",{style:t.length>0?{}:{background:"grey"},onClick:Y,children:I?e.jsx(T,{wrapperStyle:{flex:1},wrapperClass:"bagScroll loading",visible:!0,ariaLabel:"oval-loading",height:"30",color:"white",secondaryColor:"white",strokeWidth:4,strokeWidthSecondary:4}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"NEXT"}),e.jsx(ee,{})]})})]})]})}):e.jsxs("div",{id:"bagBTN",children:[e.jsx(K,{onClick:()=>n(s+1)}),(t==null?void 0:t.length)>0&&e.jsx("p",{children:t==null?void 0:t.length})]})})};export{fe as B};
